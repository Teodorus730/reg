<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–∏ —Ä–µ–ª–∏–∑—ã</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/release.css') }}">
</head>
<body>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-container">
      {% for category, message in messages %}
        <div class="flash-message flash-{{ category }}">
          {{ message }}
          <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
    <nav class="main-nav">
        <div class="nav-container">
            <!-- –õ–æ–≥–æ—Ç–∏–ø —Å–ª–µ–≤–∞ -->
            <a href="{{ url_for('client.releases') }}" class="logo-link">
                <img src="{{ url_for('static', filename='img/logo.png') }}" 
                    alt="–õ–æ–≥–æ—Ç–∏–ø" 
                    class="nav-logo">
            </a>

            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –º–µ–Ω—é -->
            <div class="nav-center">
                <a href="{{ url_for('client.releases') }}" class="nav-btn active">–ú–æ–∏ —Ä–µ–ª–∏–∑—ã</a>
                <a href="{{ url_for('client.create_release') }}" class="nav-btn">–°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑</a>
                <a href="{{ url_for('client.subs') }}" class="nav-btn">–°–∞–± –∞–∫–∫–∞—É–Ω—Ç—ã</a>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ —Å–ø—Ä–∞–≤–∞ -->
            <div class="nav-right">
                <a href="{{ url_for('auth.logout') }}" class="nav-btn logout">–í—ã–π—Ç–∏</a>
            </div>
        </div>
    </nav>

    <div class="container releases-container">
        <h1 class="page-title">–í–∞—à–∏ —Ä–µ–ª–∏–∑—ã</h1>

        {% if releases %}
            <div class="releases-grid">
                {% for release in releases %}
                    <div class="release-card">
                        <div class="release-header">
                            <span class="status-badge status-{{ release.status }}">
                                {% if release.status == 0 %}
                                    –û—Ç–∫–ª–æ–Ω–µ–Ω
                                {% elif release.status == 1 %}
                                    –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                                {% elif release.status == 2 %}
                                    –û–¥–æ–±—Ä–µ–Ω
                                {% elif release.status == 3 %}
                                    –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
                                {% endif %}
                            </span>
                            {% if release.status == 0 or release.status == 1 %}
                                <a href="{{ url_for('client.edit_release', release_id=release.id) }}" class="edit-btn">‚úé</a>
                            {% endif %}
                        </div>
                        
                        <div class="release-content">
                            <div class="cover-container">
                                {% if release.cover_path %}
                                    <img src="{{ url_for('client.uploaded_file', filename=release.cover_path) }}" 
                                         alt="–û–±–ª–æ–∂–∫–∞" 
                                         class="release-cover">
                                {% else %}
                                    <img src="{{ url_for('static', filename='img/placeholder.png') }}" 
                                         alt="–ë–µ–∑ –æ–±–ª–æ–∂–∫–∏" 
                                         class="release-cover">
                                {% endif %}
                            </div>
                            
                            <div class="release-info">
                                <h2 class="release-title">
                                    <a href="{{ url_for('client.release', release_id=release.id) }}">{{ release.title }}</a>
                                </h2>
                                
                                <div class="release-meta">
                                    <div class="meta-item">
                                        <span class="meta-label">–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:</span>
                                        <span class="meta-value">{{ release.release_date or "‚Äî" }}</span>
                                    </div>
                                    <div class="meta-item">
                                        <span class="meta-label">–ñ–∞–Ω—Ä:</span>
                                        <span class="meta-value">{{ release.genre or "‚Äî" }}</span>
                                    </div>
                                    <div class="meta-item">
                                        <span class="meta-label">–¢–∏–ø:</span>
                                        <span class="meta-value">{{ release.release_type or "‚Äî" }}</span>
                                    </div>
                                </div>
                                
                                <details class="tracklist">
                                    <summary class="tracklist-summary">
                                        <span>–¢—Ä–µ–∫-–ª–∏—Å—Ç ({{ release.tracks|length }})</span>
                                        <div class="chevron"></div>
                                    </summary>
                                    <div class="tracklist-content">
                                        {% for track in release.tracks %}
                                            <div class="track-item">
                                                <div class="track-info">
                                                    <span class="track-icon">üéµ</span>
                                                    <span class="track-title">{{ track.title }}</span>
                                                    <span class="track-title">({{ track.main_artists }})</span>
                                                    {% if track.version %}
                                                        <span class="track-version">({{ track.version }})</span>
                                                    {% endif %}
                                                </div>
                                                {% if track.audio_path %}
                                                    <a href="{{ url_for('client.uploaded_file', filename=track.audio_path) }}" 
                                                       target="_blank" 
                                                       class="track-link">
                                                        –°–ª—É—à–∞—Ç—å
                                                    </a>
                                                {% endif %}
                                            </div>
                                        {% else %}
                                            <div class="empty-tracklist">–ù–µ—Ç —Ç—Ä–µ–∫–æ–≤ –≤ —ç—Ç–æ–º —Ä–µ–ª–∏–∑–µ</div>
                                        {% endfor %}
                                    </div>
                                </details>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <img src="{{ url_for('static', filename='img/placeholder_noreleases.png') }}" 
                     alt="–ù–µ—Ç —Ä–µ–ª–∏–∑–æ–≤" 
                     class="empty-icon">
                <p class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–ª–∏–∑–æ–≤</p>
                <a href="{{ url_for('client.create_release') }}" class="btn">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑</a>
            </div>
        {% endif %}
        
    </div>
</body>
</html>