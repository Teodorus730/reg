<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BM Digital</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/release.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}">
</head>
<body>
{% include 'flash_messages.html' %}

<nav class="main-nav">
    <div class="nav-container">
        <a href="{{ url_for('client.releases') }}" class="logo-link">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="nav-logo">
        </a>

        <div class="nav-center">
            <a href="{{ url_for('client.releases') }}" class="nav-btn active">–ú–æ–∏ —Ä–µ–ª–∏–∑—ã</a>
            <a href="{{ url_for('client.create_release') }}" class="nav-btn">–°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑</a>
            <a href="{{ url_for('client.subs') }}" class="nav-btn">–°–∞–± –∞–∫–∫–∞—É–Ω—Ç—ã</a>
        </div>

        <div class="nav-right">
            <a href="{{ url_for('auth.logout') }}" class="nav-btn logout">–í—ã–π—Ç–∏</a>
        </div>
    </div>
</nav>

<div class="container releases-container">
    <h1 class="page-title">–í–∞—à–∏ —Ä–µ–ª–∏–∑—ã</h1>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <form method="get" class="status-filter">
        <div class="filter-section">

            <label class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é:<br><br>
                <input type="text" name="title" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞"
                       value="{{ title_filter }}" onchange="this.form.submit()">
            </label>

            <label class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:<br><br>
                <select name="status" class="form-input" onchange="this.form.submit()">
                    <option value="">–í—Å–µ</option>
                    <option value="0" {% if status_filter == '0' %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω–µ–Ω</option>
                    <option value="1" {% if status_filter == '1' %}selected{% endif %}>–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                    <option value="2" {% if status_filter == '2' %}selected{% endif %}>–û–¥–æ–±—Ä–µ–Ω</option>
                    <option value="3" {% if status_filter == '3' %}selected{% endif %}>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω</option>
                    <option value="4" {% if status_filter == '4' %}selected{% endif %}>–ù–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</option>
                </select>
            </label>

            <label class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:<br><br>
                <select name="username" class="form-input" onchange="this.form.submit()">
                    <option value="">–í—Å–µ</option>
                    <option value="{{main_username}}" {% if username_filter == main_username %}selected{% endif %}>–ì–ª–∞–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç</option>
                    {% for username in usernames %}
                        <option value="{{username}}" {% if username_filter == username %}selected{% endif %}>{{username}}</option>
                    {% endfor %}
                </select>
            </label>
         </div>
    </form>

    {% if releases %}
        <div class="releases-grid">
            {% for release in releases %}
                <div class="release-card">
                    <div class="release-header">
                        <span class="status-badge status-{{ release.status }}">
                            {% if release.status == 0 %}
                                –û—Ç–∫–ª–æ–Ω–µ–Ω
                            {% elif release.status == 1 %}
                                –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                            {% elif release.status == 2 %}
                                –û–¥–æ–±—Ä–µ–Ω
                            {% elif release.status == 3 %}
                                –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
                            {% elif release.status == 4 %}
                                –ù–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
                            {% endif %}
                        </span>
                        {% if release.status == 0 or release.status == 1 %}
                            <a href="{{ url_for('client.edit_release', release_id=release.id) }}" class="edit-btn">‚úé</a>
                        {% endif %}
                    </div>

                    <div class="release-content">
                        <div class="cover-container">
                            {% if release.cover_path %}
                                <img src="{{ url_for('client.uploaded_file', filename=release.cover_path) }}"
                                     alt="–û–±–ª–æ–∂–∫–∞" class="release-cover">
                            {% else %}
                                <img src="{{ url_for('static', filename='img/placeholder.png') }}"
                                     alt="–ë–µ–∑ –æ–±–ª–æ–∂–∫–∏" class="release-cover">
                            {% endif %}
                        </div>

                        <div class="release-info">
                            <h2 class="release-title">
                                <a href="{{ url_for('client.release', release_id=release.id) }}">{{ release.title }}</a>
                            </h2>

                            <div class="release-meta">
                                <div class="meta-item">
                                    <span class="meta-label">–ê—Ä—Ç–∏—Å—Ç—ã:</span>
                                    <span class="meta-value">{{ release.main_artists }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">–í–µ—Ä—Å–∏—è:</span>
                                    <span class="meta-value">{{ release.version or "‚Äî" }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">–ñ–∞–Ω—Ä:</span>
                                    <span class="meta-value">{{ release.genre or "‚Äî" }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:</span>
                                    <span class="meta-value">{{ release.release_date or "‚Äî" }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">UPC:</span>
                                    <span class="meta-value">{{ release.upc or "‚Äî" }}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>
                                    <span class="meta-value">
                                        {% if release.user.user_type == "artist" %}
                                            –ì–ª–∞–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
                                        {% else %}
                                            {{ release.user.username }}
                                        {% endif %}
                                    </span>
                                </div>
                            </div>

                            <details class="tracklist">
                                <summary class="tracklist-summary">
                                    <span>–¢—Ä–µ–∫-–ª–∏—Å—Ç ({{ release.tracks|length }})</span>
                                    <div class="chevron"></div>
                                </summary>
                                <div class="tracklist-content">
                                    {% for track in release.tracks %}
                                        <div class="track-item">
                                            <div class="track-info">
                                                <span class="track-icon">üéµ</span>
                                                <span class="track-title">{{ track.title }}</span>
                                                <span class="track-title">({{ track.main_artists }})</span>
                                                {% if track.version %}
                                                    <span class="track-version">({{ track.version }})</span>
                                                {% endif %}
                                            </div>
                                            {% if track.audio_path %}
                                                <a href="{{ url_for('client.uploaded_file', filename=track.audio_path) }}"
                                                   target="_blank" class="track-link">
                                                    –°–ª—É—à–∞—Ç—å
                                                </a>
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        <div class="empty-tracklist">–ù–µ—Ç —Ç—Ä–µ–∫–æ–≤ –≤ —ç—Ç–æ–º —Ä–µ–ª–∏–∑–µ</div>
                                    {% endfor %}
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <img src="{{ url_for('static', filename='img/placeholder_noreleases.png') }}"
                 alt="–ù–µ—Ç —Ä–µ–ª–∏–∑–æ–≤" class="empty-icon">
            <p class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–ª–∏–∑–æ–≤</p>
            <a href="{{ url_for('client.create_release') }}" class="btn">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑</a>
        </div>
    {% endif %}
</div>
</body>
</html>
